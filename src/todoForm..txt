import "./styles/todoForm.css";
import updateTodoList from "./updateTodoList";
import createTextInput from "./createTextInput";
import newElement from "./newElement";

export default function todoForm() {
  let newTaskData = {
    taskTitle: "",
    taskDescription: "",
    taskCategory: "",
    taskCompleted: false,
  };

  // Create overlay to make page unclickable
  const overlay = newElement("div", "todo-form-overlay");

  const form = document.createElement("form");
  form.className = "todo-form";

  // Add close "x" button
  const closeBtn = document.createElement("button");
  closeBtn.type = "button";
  closeBtn.textContent = "Ã—";
  closeBtn.className = "todo-form-close-btn";
  form.appendChild(closeBtn);

  const todoFormTitle = document.createElement("h3");
  todoFormTitle.className = "todo-form-title";
  todoFormTitle.textContent = "Add a new task";
  form.appendChild(todoFormTitle);

  const formTaskTitle = createTextInput();
  formTaskTitle.className = "todo-title-input";
  formTaskTitle.placeholder = "Enter task Title here";
  formTaskTitle.id = "todo-title-input";
  formTaskTitle.required = true;

  const formTaskDescription = createTextInput();
  formTaskDescription.className = "todo-description-input";
  formTaskDescription.placeholder = "Describe the task here";
  formTaskDescription.required = true;

  const categoryLabel = document.createElement("label");
  categoryLabel.textContent = "Task Category:";
  categoryLabel.className = "todo-category-label";
  categoryLabel.htmlFor = "todo-category-select";

  const categorySelect = document.createElement("select");
  categorySelect.className = "todo-category";
  categorySelect.id = "todo-category-select";
  categorySelect.required = true;

  const categories = ["Personal", "Work", "Shopping", "Other"];
  categories.forEach((cat) => {
    const option = document.createElement("option");
    option.value = cat.toLowerCase();
    option.textContent = cat;
    categorySelect.appendChild(option);
  });

  const addButton = document.createElement("button");
  addButton.type = "submit";
  addButton.textContent = "Add";
  addButton.className = "todo-add-btn";

  form.appendChild(formTaskTitle);
  form.appendChild(formTaskDescription);
  form.appendChild(categoryLabel);
  form.appendChild(categorySelect);
  form.appendChild(addButton);

  overlay.appendChild(form);
  document.body.appendChild(overlay);

  // Close form function
  function closeForm() {
    overlay.remove();
  }

  // Close on "x" click
  closeBtn.addEventListener("click", closeForm);

  // Close on submit
  form.addEventListener("submit", function (e) {
    e.preventDefault();
    newTaskData.taskTitle = formTaskTitle.value.trim();
    newTaskData.taskDescription = formTaskDescription.value.trim();
    newTaskData.taskCategory = categorySelect.value;
    updateTodoList(newTaskData);
    closeForm();
  });
}
